# Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

## üéØ –ß—Ç–æ —Ç–∞–∫–æ–µ Swagger?

Swagger (OpenAPI) - —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è REST API, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ SDK
- –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã

## üìç –î–æ—Å—Ç—É–ø –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ—Å—Ç—É–ø–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ URL:

### 1. Swagger UI (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```
http://localhost:8000/api/docs/
```
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API
- –ö—Ä–∞—Å–∏–≤–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ

### 2. ReDoc
```
http://localhost:8000/api/redoc/
```
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- –ë–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –õ—É—á—à–µ –¥–ª—è —á—Ç–µ–Ω–∏—è

### 3. OpenAPI Schema (JSON)
```
http://localhost:8000/api/schema/
```
- –ú–∞—à–∏–Ω–Ω–æ-—á–∏—Ç–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç
- –î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –¥—Ä—É–≥–∏–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Swagger UI

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ Swagger UI
–ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ –∞–¥—Ä–µ—Å—É `http://localhost:8000/api/docs/`

### 2. –ò–∑—É—á–∏—Ç–µ endpoints
–í—ã —É–≤–∏–¥–∏—Ç–µ —Ç—Ä–∏ –≥—Ä—É–ø–ø—ã:
- **Health** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è API
- **Plates** - —Ä–∞–±–æ—Ç–∞ —Å –Ω–æ–º–µ—Ä–Ω—ã–º–∏ –∑–Ω–∞–∫–∞–º–∏  
- **Vehicles** - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤–∞—Ö

### 3. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ API
1. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ª—é–±–æ–π endpoint
2. –ù–∞–∂–º–∏—Ç–µ "Try it out"
3. –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã)
4. –ù–∞–∂–º–∏—Ç–µ "Execute"
5. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### 4. –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è API
```
GET /api/health/
```
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å API –∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

#### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –Ω–æ–º–µ—Ä–æ–≤
```
GET /api/list/
```
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –Ω–æ–º–µ—Ä–Ω—ã–µ –∑–Ω–∞–∫–∏

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –Ω–æ–º–µ—Ä—É
```
GET /api/check/{plate}/
```
- –¢—Ä–µ–±—É–µ—Ç –Ω–æ–º–µ—Ä–Ω–æ–π –∑–Ω–∞–∫ –≤ URL
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¢–°

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–æ–≤

### Health Check
```json
{
  "ok": true,
  "database": "connected"
}
```

### –°–ø–∏—Å–æ–∫ –Ω–æ–º–µ—Ä–æ–≤
```json
{
  "plates": ["123ABC02", "456DEF03"],
  "count": 2
}
```

### –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¢–°
```json
{
  "plate": "123ABC02",
  "vehicle": {
    "vehicle_id": 1,
    "vin": "WVWZZZ1JZXW000001",
    "make": "Volkswagen",
    "model": "Golf",
    "year": 2019,
    "color": "white"
  },
  "owner": {
    "owner_id": 1,
    "full_name": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á",
    "iin": "900101123456",
    "dob": "1990-01-01",
    "phone": "+77010000000"
  },
  "driver_license": {
    "license_id": 1,
    "number": "KZ1234567",
    "categories": "B,BE",
    "issued_at": "2020-02-01",
    "expires_at": "2030-02-01",
    "status": "valid"
  },
  "insurance": [
    {
      "policy_number": "OSG-2025-0001",
      "type": "OSAGO",
      "insurer": "Jusan Insurance",
      "valid_from": "2025-01-01",
      "valid_to": "2025-12-31",
      "status": "active"
    }
  ],
  "accidents": [
    {
      "date": "2024-05-10",
      "severity": "minor",
      "location": "–ê–ª–º–∞—Ç—ã",
      "description": "–°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ –Ω–∞ –ø–∞—Ä–∫–æ–≤–∫–µ",
      "fault_party": "other"
    }
  ]
}
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Swagger

Swagger –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ —Ñ–∞–π–ª–µ `car_registry/settings.py`:

```python
SPECTACULAR_SETTINGS = {
    'TITLE': 'Car Registry API',
    'DESCRIPTION': 'API –¥–ª—è —Å–∏—Å—Ç–µ–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π...',
    'VERSION': '1.0.0',
    'TAGS': [
        {'name': 'Health', 'description': '–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è API'},
        {'name': 'Plates', 'description': '–†–∞–±–æ—Ç–∞ —Å –Ω–æ–º–µ—Ä–Ω—ã–º–∏ –∑–Ω–∞–∫–∞–º–∏'},
        {'name': 'Vehicles', 'description': '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤–∞—Ö'},
    ],
}
```

## üìù –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö endpoints

–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∫ –Ω–æ–≤–æ–º—É endpoint –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@extend_schema`:

```python
from drf_spectacular.utils import extend_schema, OpenApiParameter
from drf_spectacular.types import OpenApiTypes

@extend_schema(
    operation_id='my_endpoint',
    summary='–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ',
    description='–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ endpoint',
    tags=['MyTag'],
    parameters=[
        OpenApiParameter(
            name='param',
            type=OpenApiTypes.STR,
            description='–û–ø–∏—Å–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞'
        )
    ],
    responses={
        200: {
            'description': '–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç',
            'examples': {
                'application/json': {
                    'result': 'success'
                }
            }
        }
    }
)
@api_view(['GET'])
def my_endpoint(request):
    # –í–∞—à –∫–æ–¥
    pass
```

## üé® –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è

–í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥ Swagger UI, –¥–æ–±–∞–≤–∏–≤ –≤ `SPECTACULAR_SETTINGS`:

```python
SPECTACULAR_SETTINGS = {
    # ... –¥—Ä—É–≥–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    'SWAGGER_UI_SETTINGS': {
        'deepLinking': True,
        'persistAuthorization': True,
        'displayOperationId': True,
    },
    'REDOC_UI_SETTINGS': {
        'hideDownloadButton': False,
        'expandResponses': '200,201',
    },
}
```

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –Ω–µ –Ω—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å –≤—Ä—É—á–Ω—É—é
2. **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ API –≤ –±—Ä–∞—É–∑–µ—Ä–µ
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
4. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ SDK
5. **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è** - OpenAPI —Å—Ç–∞–Ω–¥–∞—Ä—Ç
